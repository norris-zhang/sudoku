<!DOCTYPE html>
<html>
    <head>
        <style>
            input {
                width: 10px;
                height: 15px;
                padding-left: 5px;
            }
        </style>
    </head>
    <body>
        <table>
            <tr>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
            </tr>
            <tr>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
            </tr>
            <tr>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
            </tr>
            <tr>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
            </tr>
            <tr>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
            </tr>
            <tr>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
            </tr>
            <tr>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
            </tr>
            <tr>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
            </tr>
            <tr>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
                <td><input type="text" name="metrixValue" maxlength="1" value="0"></td>
            </tr>
            <tr>
                <td colspan="9">
                    show process: <input type="radio" name="showProcess" id="showProcessYes" value="yes"><label for="showProcessYes">Yes</label>
                    <input type="radio" name="showProcess" id="showProcessNo" value="no" checked="checked"><label for="showProcessNo">No</label>
                    <button onclick="start()">Start</button>
                </td>
            </tr>
        </table>
        <script>
            var delay = 100;
            var step = 50;
            var stack = new Array();
            function start() {
                var inputs = document.getElementsByName("metrixValue");
                var valueArr = [];
                for (var i = 0; i < inputs.length; i++) {
                    valueArr.push(parseInt(inputs[i].value));
                }
                var metrix = new SudoMetrix();
                metrix.load(valueArr);
                var minPossibilities = metrix.getMinPossibilities();
                if (minPossibilities == null) {
                    return;
                }
                metrix.currentPossibilities = minPossibilities;
                metrix.possibilityPosition = 0;
                metrix.set(minPossibilities[0][0], minPossibilities[0][1], minPossibilities[1][0]);
                stack.push(metrix);
                fillInputs(stack[stack.length - 1]);
                var result = execute();
                
                if (result != null) {
                    fillInputs(result);
                } else {
                    alert('Failed');
                }
            }
            function execute() {
                while (1) {
                    stackToTop();
                    var peek = stack[stack.length - 1];
                    if (peek.isCorrect()) {
                        return peek;
                    }
                    var nextPos = peek.possibilityPosition + 1;
                    var currentPossibilities = peek.currentPossibilities;
                    while (nextPos >= currentPossibilities[1].length) {
                        if (stack.length === 0) {
                            return null;
                        }
                        stack.pop();
                      fillInputs(stack[stack.length - 1]);
                        peek = stack[stack.length - 1];
                        nextPos = peek.possibilityPosition + 1;
                        currentPossibilities = peek.currentPossibilities;
                    }
                    peek.set(currentPossibilities[0][0], currentPossibilities[0][1], currentPossibilities[1][nextPos]);
                    peek.possibilityPosition = nextPos;
                }
            }
            function stackToTop() {
                while (1) {
                    var peek = stack[stack.length - 1];
                    var minPossibilities = peek.getMinPossibilities();
                    if (minPossibilities == null) {
                        break;
                    }
                    var clone = cloneSudoMetrix(peek);
                    clone.currentPossibilities = minPossibilities;
                    clone.possibilityPosition = 0;
                    clone.set(minPossibilities[0][0], minPossibilities[0][1], minPossibilities[1][0]);
                    stack.push(clone);
                    fillInputs(stack[stack.length - 1]);
                }
            }

            function cloneSudoMetrix(sudoMetrix) {
                var clone = new SudoMetrix();
                clone.load(filledArray(9 * 9, 0));
                for (var i = 0; i < sudoMetrix.metrix.length; i++) {
                    for (var j = 0; j < sudoMetrix.metrix[i].length; j++) {
                        clone.metrix[i][j] = sudoMetrix.metrix[i][j];
                    }
                }
                this.currentPossibilities = null;
                this.possibilityPosition = 0;
                return clone;
            }
            function filledArray(capacity, defaultValue) {
                var arr = new Array();
                for (var i = 0; i < capacity; i++) {
                    arr.push(defaultValue);
                }
                return arr;
            }
            function fillInputs(top) {
                var showProcess = document.getElementById("showProcessYes");
                if (showProcess && showProcess.checked) {
                    delayFillInputs(top);
                } else {
                    var inputs = document.getElementsByName("metrixValue");
                    var index = 0;
                    for (var i = 0; i < top.metrix.length; i++) {
                        for (var j = 0; j < top.metrix[i].length; j++) {
                            inputs[index++].value = top.metrix[i][j];
                        }
                    }
                }
            }
            function delayFillInputs(top) {
                delay += step;
                setTimeout(function(){
                    var inputs = document.getElementsByName("metrixValue");
                    var index = 0;
                    for (var i = 0; i < top.metrix.length; i++) {
                        for (var j = 0; j < top.metrix[i].length; j++) {
                            inputs[index++].value = top.metrix[i][j];
                        }
                    }
                }, delay);
                
            }

            class SudoMetrix {
                constructor() {
                    this.metrix = [];
                    this.currentPossibilities = null;
                    this.possibilityPosition = 0;
                }
                load(initialMetrix) {
                    for (var i = 0; i < initialMetrix.length; i++) {
                        if (i % 9 == 0) {
                            this.metrix.push([]);
                        }
                        this.metrix[this.metrix.length - 1].push(initialMetrix[i]);
                    }
                }
                toString() {
                    var str = "";
                    for (var i = 0; i < this.metrix.length; i++) {
                        for (var j = 0; j < this.metrix[i].length; j++) {
                            str += this.metrix[i][j] + ' '
                        }
                        str += "\n";
                    }
                    return str;
                }
                set(row, col, num) {
                    this.metrix[row][col] = num;
                }
                getMinPossibilities() {
                    var position = [0,0];
                    var possibleNumbers = new Array();
                    for (var i = 0; i < this.metrix.length; i++) {
                        for (var j = 0; j < this.metrix[i].length; j++) {
                            if (this.metrix[i][j] != 0) {
                                continue;
                            }
                            var tempPossibleNumbers = new Array();
                            for (var num = 1; num <= 9; num++) {
                                if (this.isPossible(i, j, num)) {
                                    tempPossibleNumbers.push(num);
                                }
                            }
                            if (possibleNumbers.length == 0 || tempPossibleNumbers.length < possibleNumbers.length) {
                                possibleNumbers = tempPossibleNumbers;
                                position[0] = i;
                                position[1] = j;
                            }
                        }
                    }
                    if (possibleNumbers.length == 0) {
                        return null;
                    }
                    return [position, possibleNumbers];
                }
                isPossible(row, col, num) {
                    for (var i = 0; i < this.metrix[row].length; i++) {
                        if (i !== col && this.metrix[row][i] === num) {
                            return false;
                        }
                    }
                    for (var i = 0; i < this.metrix.length; i++) {
                        if (i !== row && this.metrix[i][col] === num) {
                            return false;
                        }
                    }
                    var fromRow = row - row % 3;
                    var toRow = fromRow + 2;
                    var fromCol = col - col % 3;
                    var toCol = fromCol + 2;
                    for (var i = fromRow; i <= toRow; i++) {
                        for (var j = fromCol; j <= toCol; j++) {
                            if (i !== row && j !== col && this.metrix[i][j] === num) {
                                return false;
                            }
                        }
                    }
                    return true;
                }
                isCorrect() {
                    for (var i = 0; i < this.metrix.length; i++) {
                        for (var j = 0; j < this.metrix[i].length; j++) {
                            if (this.metrix[i][j] == 0) {
                                return false;
                            }
                            if (!this.isPossible(i, j, this.metrix[i][j])) {
                                return false;
                            }
                        }
                    }
                    return true;
                }
            }
        </script>
    </body>
</html>